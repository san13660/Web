<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Hello!</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  </head>  
  <body>
    <div id="root"></div>
    
    <script type="text/babel">
      class Card extends React.Component {
        constructor(props) {
          super(props)

          this.state = {
            backgroundColor: 'red'
          }
        }

        render() {
          const onItemClick = ({event}) => {
            this.state.backgroundColor = 'blue';
          }

          let style = {
            backgroundColor: this.state.backgroundColor,
            width: '40px',
            height: '40px',
            position: 'absolute',
            top: `${this.props.cardPosition.y}px`,
            left: `${this.props.cardPosition.x}px`
          }

          return <div style={style} onClick={onItemClick}/>
        }
      }
      
      class Game extends React.Component {
        constructor(props) {
          super(props)
          
          this.state = {
            enemy: {
              x: 20,
              y: 20
            },
            player: {
              x: 180,
              y: 320
            },
            bullet: {
              x: 1000,
              y: 360
            }
          }
        }
        
        componentDidMount() {
            const frame = () => {
              if (this.state.enemy.x >= 340 || this.state.enemy.x < 20) { 
                this.setState({
                  enemy: {
                    x: 20,
                    y: this.state.enemy.y + 10
                  }
                })
              } else {
                this.setState({
                  enemy: {
                    x: this.state.enemy.x + 2,
                    y: this.state.enemy.y
                  }
                })
              }
              
              this.setState({
                bullet: {
                  x: this.state.bullet.x,
                  y: this.state.bullet.y - 5
                }
              })
              
              
          
          if (!(
              this.state.enemy.x + 40 < this.state.bullet.x || 
              this.state.enemy.y + 40 < this.state.bullet.y || 
              this.state.enemy.x > this.state.bullet.x + 40 || 
              this.state.enemy.y > this.state.bullet.y + 40
          )) {
            alert('You win!')
          }
              
              requestAnimationFrame(frame)
            }
            
            requestAnimationFrame(frame)
        }
        
        handleKeyDown(e) {
          if (e.key == 'd') {
              this.setState({
                player: {
                  x: this.state.player.x + 5,
                  y: 320
                }
              })
          }
          
          if (e.key == 'a') {
              this.setState({
                player: {
                  x: this.state.player.x - 5,
                  y: 320
                }
              })
          }
          
          
          if (e.key == 'w') {
              this.setState({
                bullet: {
                  x: this.state.player.x,
                  y: 320
                }
              })
          }
          
        }
        
        render() {
          const style = {
              backgroundColor: 'black',
              width: '400px',
              height: '400px',
              position: 'relative'
          }

          const items = []

          for (let i=1; i<5; i++) {
            for (let j=1; j<5; j++) {
              let things = {
                x: 50 * j,
                y: 50 * i
            }
              items.push(<Card cardPosition={things} />)
            }
          }
          return (
            <div style={style} onKeyPress={this.handleKeyDown.bind(this)} tabIndex={0}>
              {items}
            </div>
          )
        }
      }
      
      ReactDOM.render(
        <Game />,
        document.getElementById('root')
      )
    </script>
  </body>
</html>
