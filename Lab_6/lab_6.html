<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Hello!</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  </head>  
  <body>
    <div id="root"></div>
    
    <script type="text/babel">
      class Card extends React.Component {
        constructor(props) {
          super(props)
        }

        render() {
          let style = {
            backgroundColor: this.props.cardData.backgroundColor,
            width: '80px',
            height: '80px',
            position: 'absolute',
            top: `${this.props.cardData.y}px`,
            left: `${this.props.cardData.x}px`
          }

          const g = {
            index: this.props.cardData.index
          }

          return <div style={style} onClick={this.props.function.bind(null, g)}/>
        }
      }
      
      class Game extends React.Component {
        constructor(props) {
          super(props)
          
          let cardst = []

          for (let i=0; i<4; i++) {
            for (let j=0; j<4; j++) {
              const things = {
                index: (i*4)+j,
                backgroundColor: 'red',
                x: 100 * j,
                y: 100 * i
              }
              cardst.push(things)
            }
          }

          this.state = {
            cards: cardst
          }
        }
        
        componentDidMount() {
            const frame = () => {
              
              requestAnimationFrame(frame)
            }
            
            requestAnimationFrame(frame)
        }
        
        handleKeyDown(e) {
          if (e.key == 'd') {
              this.setState({
                player: {
                  x: this.state.player.x + 5,
                  y: 320
                }
              })
          }
          
          if (e.key == 'a') {
              this.setState({
                player: {
                  x: this.state.player.x - 5,
                  y: 320
                }
              })
          }
          
          
          if (e.key == 'w') {
              this.setState({
                bullet: {
                  x: this.state.player.x,
                  y: 320
                }
              })
          }
          
        }
        
        render() {
          let items = []

          const style = {
              backgroundColor: 'black',
              width: '400px',
              height: '400px',
              position: 'relative'
          }

          const onItemClick = (p) => {
            let cardst = this.state.cards
            cardst[p.index].backgroundColor = 'blue'
            this.setState({
              cards: cardst
            })
          }


          for (let i=0; i<Object.keys(this.state.cards).length; i++) {
            items.push(<Card cardData={this.state.cards[i]} function={onItemClick} />)
          }
          return (
            <div style={style} onKeyPress={this.handleKeyDown.bind(this)} tabIndex={0}>
              {items}
            </div>
          )
        }
      }
      
      ReactDOM.render(
        <Game />,
        document.getElementById('root')
      )
    </script>
  </body>
</html>
