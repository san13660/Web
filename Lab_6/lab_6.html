<!DOCTYPE html>
<html lang="en">

<head>
  <title>Memoria</title>
  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">

      class Card extends React.Component {
        constructor(props) {
          super(props)
        }

        render() {
          let style = {
            backgroundColor: this.props.cardData.backgroundColor,
            width: '80px',
            height: '80px',
            position: 'absolute',
            top: `${this.props.cardData.y}px`,
            left: `${this.props.cardData.x}px`
          }

          const g = {
            index: this.props.cardData.index
          }

          return <div className={this.props.cardData.animation} style={style} onClick={this.props.function.bind(null, g)}>
                    <div style={{margin: 'auto'}}>
                      {this.props.cardData.value}
                    </div>
                  </div>
        }
      }
      
      class Game extends React.Component {
        constructor(props) {
          super(props)

          let cardst = []

          let iconsLeft = [0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7]

          for (let i=0; i<4; i++) {
            for (let j=0; j<4; j++) {
              let iconIndex = Math.floor(Math.random() * iconsLeft.length)
              const things = {
                index: (i*4)+j,
                backgroundColor: 'red',
                animation: '',
                x: 100 * j,
                y: 100 * i,
                value: iconsLeft[iconIndex]
              }
              cardst.push(things)
              iconsLeft.splice(iconIndex, 1);
            }
          }

          this.state = {
            cards: cardst,
            selectedCardValue: -1
          }
        } 

        selectCard(value){
          if(this.state.selectedCardValue == -1){
            this.setState({selectedCardValue: value})
            return 
          }else{
            if(this.state.selectedCardValue == value){
              return 1
            }else{
              return 2
            }
          }
        }
        
        componentDidMount() {
            const frame = () => {
              
              requestAnimationFrame(frame)
            }
            
            requestAnimationFrame(frame)
        }
        
        render() {
          let items = []

          const style = {
              backgroundColor: 'black',
              width: '400px',
              height: '400px',
              position: 'relative'
          }

          const onItemClick = (p) => {
            let cardst = this.state.cards
            cardst[p.index].backgroundColor = 'blue'
            cardst[p.index].animation = 'animated flipInY'
            this.setState({
              cards: cardst
            })
          }


          for (let i=0; i<Object.keys(this.state.cards).length; i++) {
            items.push(<Card cardData={this.state.cards[i]} function={onItemClick} />)
          }
          return (
            <div style={style} onKeyPress={this.handleKeyDown.bind(this)} tabIndex={0}>
              {items}
            </div>
          )
        }
      }
      
      ReactDOM.render(
        <Game />,
        document.getElementById('root')
      )
    </script>
</body>

</html>